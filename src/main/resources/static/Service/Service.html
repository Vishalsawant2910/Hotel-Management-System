<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="ServiceStyle.css">
    <meta charset="UTF-8">
    <title>Services Page</title>
      <link rel="icon" href= 
"/android-chrome-512x512.png" 
          type="image/x-icon"> 
     <link href=
"https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity=
"sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
          crossorigin="anonymous"/>
    <script>
        async function fetchServices() {
            const searchQuery = document.getElementById('search').value.toLowerCase();
            const response = await fetch('/services');
            const services = await response.json();
            const table = document.getElementById('servicesTable');
            const tbody = table.querySelector('tbody');

            while (tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
            }

            services.forEach(service => {
                if (service.serviceName.toLowerCase().includes(searchQuery) ||
                    service.status.toLowerCase().includes(searchQuery)
                ) {
                    const row = tbody.insertRow(-1);
                    const idCell = row.insertCell(0);
                    const nameCell = row.insertCell(1);
                    const statusCell = row.insertCell(2);
                    const descCell = row.insertCell(3);
                    const priceCell = row.insertCell(4);

                    idCell.textContent = service.serviceID;
                    nameCell.textContent = service.serviceName;
                    statusCell.textContent = service.status;
                    descCell.textContent = service.desc;
                    priceCell.textContent = service.price.toLocaleString();

                    const actionCell = row.insertCell(5);
                    const editButton = document.createElement('button');
                    editButton.textContent = 'Edit';
                    editButton.className = 'btn btn-outline-success';
                    editButton.onclick = () => openEditModal(service);
                    actionCell.appendChild(editButton);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.className = 'btn btn-outline-danger';
                    deleteButton.onclick = () => deleteService(service.serviceID);
                    actionCell.appendChild(deleteButton);

                }
            });
        }

        async function createService(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const response = await fetch('/services', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(Object.fromEntries(formData))
            });
            if (response.ok) {
                location.reload();
            } else {
                alert('Failed to create service.');
            }
        }

        async function deleteService(serviceID) {
            const response = await fetch(`/services/${serviceID}`, {
                method: 'DELETE',
            });

            if (response.ok) {
                location.reload();
            } else {
                alert('Failed to delete service.');
            }
        }

        async function openEditModal(service) {
            const modal = document.getElementById('editModal');
            modal.style.display = 'block';

            document.getElementById('editServiceID').value = service.serviceID;
            document.getElementById('editServiceName').value = service.serviceName;
            document.getElementById('editStatus').value = service.status;
            document.getElementById('editDesc').value = service.desc;
            document.getElementById('editPrice').value = service.price;
        }

        async function updateService(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const serviceID = formData.get('serviceID');
            const response = await fetch(`/services/${serviceID}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(Object.fromEntries(formData)),
            });

            if (response.ok) {
                location.reload();
            } else {
                alert('Failed to update service.');
            }
        }

        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
        
          function showCreateModal() {
            document.getElementById('createModal').style.display = 'block';
        }

        function hideCreateModal() {
            document.getElementById('createModal').style.display = 'none';
        }

        function toggleCreateForm() {
            const form = document.getElementById('createServiceForm');
            if (form.style.maxHeight) {
                form.style.maxHeight = null;
            } else {
                form.style.maxHeight = form.scrollHeight + 'px';
            }
        }
        
        
    </script>
</head>
<body onload="fetchServices();">
	<div class="container">
<nav class="navbar navbar-dark bg-dark">
   <a href="/index.html">Home</a>
    <a href="/Guest/Guest.html">Guest</a>
    <a href="/Room/Room.html">Room</a>
    <a href="/Reservation/Reservation.html">Reservation</a>
    <a href="/Service/Service.html">Service</a>
    <a href="/ServiceUsage/ServiceUsage.html">Service Usage</a>
    <a href="/Staff/Staff.html">Staff</a>
</nav>
</div>
<div class="searchBlock">
    <label for="search">Search:</label>
    <input type="text" id="search" placeholder="Search by name, status" oninput="fetchServices();">
</div>

<div class="container" align="center">
	
	<button id="createServiceButton" onclick="toggleCreateForm();"  class="btn btn-info">Create Service</button>
	
</div>

<div id="createServiceForm" align="center">
 
<form onsubmit="createService(event);" class="formBlock" align="center" style="width: 400px;">
    <label for="serviceName" style="text-align:center">Service Name:</label>
    <input type="text" id="serviceName" placeholder="serviceName" name="serviceName" required>

    <label for="status" style="text-align:center">Status:</label>
    <select id="status" name="status" required>
        <option value="ACTIVE" style="text-align:center">ACTIVE</option>
        <option value="INACTIVE">INACTIVE</option>
    </select>

    <label for="desc" style="text-align:center">Description:</label>
    <input type="text" id="desc" name="desc" placeholder="Description" required>

    <label for="price" style="text-align:center">Price:</label>
    <input type="number" id="price" name="price" placeholder="price" step="0.01" required><br>

    <button type="submit" class="btn btn-success btn-md" class="text-center" align="center"style="width: 200px; margin: 0 auto;">Create Service</button>
</form>
</div>


<div class="container mt-3">
<table id="servicesTable" class="table table-bordered">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Status</th>
        <th>Description</th>
        <th>Price</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>
</div>



<div id="editModal">
    <div id="editModalContent">
        <h2>Edit Service</h2>
        <form onsubmit="updateService(event);">
            <input type="hidden" id="editServiceID" name="serviceID">
            <label for="editServiceName">Service Name:</label>
            <input type="text" id="editServiceName" name="serviceName" required>
            <label for="editStatus">Status:</label>
            <select id="editStatus" name="status" required>
                <option value="ACTIVE">ACTIVE</option>
                <option value="INACTIVE">INACTIVE</option>
            </select>
            <label for="editDesc">Description:</label>
            <input type="text" id="editDesc" name="desc" required>
            <label for="editPrice">Price:</label>
            <input type="number" id="editPrice" name="price" step="0.01" required>
            <button type="submit">Update Service</button>
            <button type="button" onclick="document.getElementById('editModal').style.display = 'none';">Close</button>
        </form>
    </div>
</div>
</body>
</html>
